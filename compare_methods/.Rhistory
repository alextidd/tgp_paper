header = T, stringsAsFactors = F
)
read.delim(
paste0(inDir, trait, ".best_pval_per_cs.tsv"),
header = T, stringsAsFactors = F
) %>% dplyr::as_tibble() %>% {
if (trait == "PrCa")
dplyr::group_by(., CredibleSet) %>%
# best SNP
dplyr::filter(p == min(p)) %>%
# if more than one bestSNP, just randomly sample one (this only affects the distance predictions, not the ABC predictions)
dplyr::filter(dplyr::row_number() == 1) %>%
dplyr::ungroup()
else .
} %>%
dplyr::transmute(BestSNPPos = position,
BestSNP = variant,
CredibleSet)
read.delim(
paste0(inDir, trait, ".best_pval_per_cs.tsv"),
header = T, stringsAsFactors = F
) %>% dplyr::as_tibble()
read.delim(
paste0(inDir, trait, ".best_pval_per_cs.tsv"),
header = T, stringsAsFactors = F
) %>% dplyr::as_tibble() %>% {
if (trait == "PrCa")
dplyr::group_by(., CredibleSet) %>%
# best SNP
dplyr::filter(p == min(p)) %>%
# if more than one bestSNP, just randomly sample one (this only affects the distance predictions, not the ABC predictions)
dplyr::filter(dplyr::row_number() == 1) %>%
dplyr::transmute(BestSNPPos = position,
BestSNP = variant,
CredibleSet) %>%
dplyr::ungroup()
else .
}
setwd("/working/lab_jonathb/alexandT/")
sessionInfo()
trait = "IBD"
celltypes <- opts[2] # celltypes = "enriched_tissues" #
celltypes = "enriched_tissues" #
baseDir <- "/working/lab_jonathb/alexandT/tgp_paper/"
wkdir <- "/working/lab_jonathb/alexandT/tgp_paper/compare_methods/" ; setwd(wkdir)
variant_to_gene_max_distance = 2e6
devtools::load_all("/working/lab_jonathb/alexandT/tgp/")
library(tidyverse)
cat(trait, celltypes, "#############\n")
outDir <- paste("output", trait, celltypes, "", sep = "/")
# get trait drivers / variants ====
drivers <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".Drivers.txt"))$V1 %>%
# add info
{ dplyr::filter(TSSs, symbol %in% .)}
drivers
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5)
# txv masterlist ====
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master
txv_master %>% dplyr::distinct(cs, symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1)
unique(drivers$symbol)
variant_to_gene_max_distance = 1e6
cat(trait, celltypes, "#############\n")
outDir <- paste("output", trait, celltypes, "", sep = "/")
# get trait drivers / variants ====
drivers <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".Drivers.txt"))$V1 %>%
# add info
{ dplyr::filter(TSSs, symbol %in% .)}
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5)
# txv masterlist ====
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::distinct() %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1)
variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
# txv masterlist ====
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1)
trait = "IBD"
celltypes = "enriched_tissues" #
baseDir <- "/working/lab_jonathb/alexandT/tgp_paper/"
wkdir <- "/working/lab_jonathb/alexandT/tgp_paper/compare_methods/" ; setwd(wkdir)
variant_to_gene_max_distance = 1e6
devtools::load_all("/working/lab_jonathb/alexandT/tgp/")
library(tidyverse)
cat(trait, celltypes, "#############\n")
outDir <- paste("output", trait, celltypes, "", sep = "/")
# get trait drivers / variants ====
drivers <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".Drivers.txt"))$V1 %>%
# add info
{ dplyr::filter(TSSs, symbol %in% .)}
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5)
# txv masterlist ====
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master
txv_master %>% dplyr::distinct(cs, symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1)
variants
cs <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.cs.txt", header = T)
cs
cs_to_consider <- cs %>% dplyr::filter(!AnyCoding, !AnyPromoter, !AnySpliceSite)
cs_to_consider
variants <- variants %>% dplyr::filter(cs %in% cs_to_consider$CredibleSet)
# txv masterlist ====
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1)
cs
variants
varscores <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.variant.list.txt", header = T)
varscores
varscores %>% dplyr::filter(PosteriorProb > 0.1)
varscores %>% dplyr::filter(PosteriorProb > 0.1) -> vars_to_consider
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5) %>% dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant)
variants
# txv masterlist ====
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1)
sessionInfo()
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1) %>% View
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1) %>% dplyr::arrange(cs, symbol) %>% View
cs_to_consider %>% dplyr::filter(CredibleSet == "Huang2017-r173-1")
cs_to_consider
cs_to_consider  %>% dplyr::filter(TargetGene == "CD40")
cs_to_consider  %>% dplyr::filter(TargetGene %in% c("ERGIC1", "NR5A2"))
cs_to_consider  %>% dplyr::filter(symbol %in% c("ERGIC1", "NR5A2"))
cs_to_consider
txv_master  %>% dplyr::filter(symbol %in% c("ERGIC1", "NR5A2"))
cs
cs %>% dplyr::filter(CredibleSet %in% c("Huang2017-r71-1",Huang2017-r22-1))
cs %>% dplyr::filter(CredibleSet %in% c("Huang2017-r71-1","Huang2017-r22-1"))
cs_to_consider %>% dplyr::filter(CredibleSet %in% c("Huang2017-r71-1","Huang2017-r22-1"))
vars_to_consider %>% dplyr::filter(CredibleSet %in% c("Huang2017-r71-1","Huang2017-r22-1"))
variant_to_gene_max_distance
cs <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.cs.txt", header = T)
cs_to_consider <- cs %>% dplyr::filter(!AnyCoding, !AnyPromoter, !AnySpliceSite)
varscores <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.variant.list.txt", header = T)
vars_to_consider <- varscores %>% dplyr::filter(PosteriorProb > 0.1)
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5) %>%
dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant)
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::filter(symbol %in% drivers$symbol) %>% dplyr::group_by(cs) %>% dplyr::filter(dplyr::n() == 1)
txv_master
txv_master %>% dplyr::filter(cs == "IBD Huang2017-r22-1")
txv_master %>% dplyr::filter(cs == "Huang2017-r22-1")
txv_master %>% dplyr::filter(cs == "Huang2017-r22-1", symbol %in% drivers$symbol)
txv_master %>% dplyr::filter(cs == "Huang2017-r22-1", symbol %in% drivers$symbol)  %>% dplyr::distinct(symbol)
TSSs %>% dplyr::filter(symbol == "C1orf106")
TSSs %>% dplyr::filter(symbol == "INAVA")
cs <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.cs.txt", header = T)
cs_to_consider <- cs %>% dplyr::filter(!AnyCoding, !AnyPromoter, !AnySpliceSite)
varscores <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.variant.list.txt", header = T)
vars_to_consider <- varscores %>% dplyr::filter(PosteriorProb > 0.1)
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5) %>%
dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant)
# get trait drivers / variants ====
drivers <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".Drivers.txt"))$V1 %>%
# add info
{ dplyr::filter(TSSs, symbol %in% .)}
drivers$symbol %>% unique
trait
read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".Drivers.txt"))$V1
read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".Drivers.txt"))$V1 %>% sort
read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".Drivers.txt"))$V1 %>%
# add info
{ dplyr::filter(TSSs, symbol %in% .)}
read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".Drivers.txt"))$V1 %>%
# add info
{ dplyr::filter(TSSs, symbol %in% .)} %>% dplyr::pull(symbol) %>% unique %>% sort
# get trait drivers / variants ====
drivers <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".Drivers.txt"))$V1 %>%
# add info
{ dplyr::filter(TSSs, symbol %in% .)}
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5)
cs <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.cs.txt", header = T)
cs_to_consider <- cs %>% dplyr::filter(!AnyCoding, !AnyPromoter, !AnySpliceSite)
varscores <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.variant.list.txt", header = T)
vars_to_consider <- varscores %>% dplyr::filter(PosteriorProb > 0.1)
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5) %>%
dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant)
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1)
txv_master
txv_master %>% dplyr::filter(symbol == "ERGIC1")
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol)%>% dplyr::filter(symbol == "ERGIC1")
cs
cs %>% dplyr::filter(CredibleSet == "Huang2017-nonFm84")
cs %>% dplyr::filter(CredibleSet == "Huang2017-r71-1")
cs %>% dplyr::filter(CredibleSet == "Huang2017-nonFm84")
txv_master %>% dplyr::filter(CredibleSet == "Huang2017-nonFm84")
txv_master %>% dplyr::filter(cs == "Huang2017-nonFm84")
txv_master %>% dplyr::filter(cs == "Huang2017-r71-1")
cs <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.cs.txt", header = T)
cs_to_consider <- cs %>% dplyr::filter(!AnyCoding, !AnyPromoter, !AnySpliceSite)
varscores <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.variant.list.txt", header = T)
vars_to_consider <- varscores %>% dplyr::filter(PosteriorProb > 0.1)
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed"))
txv_master <- variants %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5) %>%
dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant) %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
cs <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.cs.txt", header = T)
cs_to_consider <- cs %>% dplyr::filter(!AnyCoding, !AnyPromoter, !AnySpliceSite)
varscores <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.variant.list.txt", header = T)
vars_to_consider <- varscores %>% dplyr::filter(PosteriorProb > 0.1)
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5)
variants
variants  %>%
dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant)
variants  %>%
dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant) %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T)
txv_master <- variants  %>%
dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant) %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
variants
variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end))
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1)
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1) %>% dplyr::filter(cs == "Huang2017-nonFm84")
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1) %>% dplyr::filter(cs == "Huang2017-r71-1")
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1)
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1, cs == "Huang2017-r71-1")
txv_master %>%
dplyr::filter(cs == "Huang2017-r71-1")
TSSs %>% dplyr::filter(symbol == "ERGIC1")
cs
cs_to_consider %>% dplyr::filter(CredibleSet == "Huang2017-r71-1")
TSSs %>% dplyr::filter(symbol == "ERGIC1")
TSSs %>% dplyr::filter(symbol == "ERGIC1") %>% dplyr::mutate(end = end - dplyr::filter(cs_to_consider, CredibleSet == "Huang2017-r71-1")$start)
txv_master
txv_master %>% dplyr::filter(symbol == "CD40")
drivers$symbol %>% unique %>% sort
txv_master %>% dplyr::filter(symbol == "CD40") %>%dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol, "CD40" %in% symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>% dplyr::group_by(cs) %>%
dplyr::filter(symbol %in% drivers$symbol, "CD40" %in% symbol)
txv_master %>% dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol, cs == "Huang2017-r173-1")
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1)
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end)) %>%
dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant)
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1)
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1) %>% dplyr::filter(cs == "Huang2017-r173-1")
cs%>% dplyr::filter(cs == "Huang2017-r173-1")
cs %>% dplyr::filter(CredibleSet == "Huang2017-r173-1")
cs
cs_to_consider %>% dplyr::filter(CredibleSet == "Huang2017-r173-1")
cs <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.cs.txt", header = T)
cs_to_consider <- cs %>% dplyr::filter(!AnyCoding, !AnySpliceSite)
varscores <- read_tibble("/working/lab_jonathb/alexandT/tgp_paper/wrangle_package_data//data/Traits/IBD//IBDCombined.set1-2.variant.list.txt", header = T)
vars_to_consider <- varscores %>% dplyr::filter(PosteriorProb > 0.1)
variants <- read_tibble(paste0(baseDir, "wrangle_package_data/output/Traits/", trait, "/", trait, ".VariantList.bed")) %>%
dplyr::select(chrom = V1, start = V2, end = V3, variant = V4, cs = V5)
txv_master <- variants %>%
# expand variant coords to search range
valr::bed_slop(both = variant_to_gene_max_distance,
genome = ChrSizes,
trim = T) %>%
# get all TSSs within search range of each variant
bed_intersect_left(., TSSs,
suffix = c(".variant", ".TSS")) %>%
# restore variant coords
dplyr::select(-c(start, end)) %>%
dplyr::inner_join(variants) %>%
# add distance
dplyr::mutate(distance = abs(end.TSS - end)) %>%
dplyr::filter(cs %in% cs_to_consider$CredibleSet, variant %in% vars_to_consider$variant)
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1)
txv_master
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1)
txv_master %>%
dplyr::distinct(cs, symbol) %>%
dplyr::filter(symbol %in% drivers$symbol) %>%
dplyr::group_by(cs) %>%
dplyr::filter(dplyr::n() == 1) %>% View
q()
